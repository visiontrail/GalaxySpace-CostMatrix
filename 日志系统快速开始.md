# 日志系统快速开始 🚀

## 一分钟了解日志系统

您的系统现在已经拥有完整的日志记录功能！所有关键操作都会被自动记录，无需任何配置。

## 快速测试

### 1. 运行测试脚本（验证日志系统）

```bash
python3 test_logging.py
```

**预期结果**: 
- ✅ 所有测试通过
- 在 `logs/` 目录下生成日志文件

### 2. 启动系统并查看日志

```bash
# 终端1: 启动系统
python3 main.py

# 终端2: 实时查看日志
tail -f logs/main.log
```

### 3. 发送测试请求

```bash
# 使用测试文件（如果有）
curl -X POST "http://localhost:8000/api/analyze" \
  -F "file=@test_data.xlsx"
```

**查看日志**:
```bash
# 查看所有日志
tail -30 logs/main.log

# 查看错误日志
grep "ERROR" logs/*.log
```

## 日志文件位置

```
logs/
├── main.log                # 主程序（API请求）★ 最重要
├── data_loader.log         # 数据加载
├── analysis_service.log    # 数据分析
└── export_service.log      # Excel导出
```

## 常用命令

### 查看日志

```bash
# 实时查看所有日志
tail -f logs/*.log

# 查看主日志最近50行
tail -50 logs/main.log

# 查看所有错误
grep "ERROR" logs/*.log

# 查看今天的日志
grep "$(date +%Y-%m-%d)" logs/main.log
```

### 查找特定请求

每个API请求都有一个8位请求ID，在响应中返回：

```bash
# 使用请求ID查找所有相关日志
grep "a1b2c3d4" logs/*.log
```

### 性能分析

```bash
# 查看性能日志
grep "PERFORMANCE" logs/main.log

# 查看慢请求（耗时>2秒）
grep "Duration: [2-9][0-9][0-9][0-9]" logs/main.log
```

## 日志格式说明

```
2026-01-05 20:30:45 - [INFO] - [main:analyze_travel_data:75] - [a1b2c3d4] 接收到分析请求，文件名: data.xlsx
```

- `2026-01-05 20:30:45` - 时间戳
- `[INFO]` - 日志级别（DEBUG/INFO/WARNING/ERROR）
- `[main:analyze_travel_data:75]` - 模块:函数:行号
- `[a1b2c3d4]` - 请求ID（用于追踪）
- 后面是日志内容

## 故障排查

### 问题：API请求失败

```bash
# 1. 查看最近的错误
grep "ERROR" logs/main.log | tail -10

# 2. 如果有请求ID，搜索完整链路
grep "请求ID" logs/*.log

# 3. 查看详细堆栈
cat logs/main.log | grep -A 10 "ERROR"
```

### 问题：数据加载失败

```bash
# 查看数据加载日志
grep "ERROR\|WARNING" logs/data_loader.log

# 查看无效数据
grep "无效" logs/data_loader.log
```

### 问题：性能慢

```bash
# 查看耗时统计
grep "PERFORMANCE" logs/main.log | tail -20

# 查看各阶段耗时
grep "耗时:" logs/main.log
```

## 配置调整（可选）

### 修改日志级别

编辑 `logger_config.py`:

```python
# 开发环境：更详细的日志
level = logging.DEBUG

# 生产环境：只记录重要信息
level = logging.INFO  # 或 WARNING
```

### 修改日志文件大小

```python
max_bytes = 20 * 1024 * 1024  # 改为20MB
backup_count = 10              # 保留10个备份
```

## 日志维护

### 日常维护

```bash
# 查看日志文件大小
ls -lh logs/

# 查看今天的统计
echo "今日请求数: $(grep -c "REQUEST_START" logs/main.log)"
echo "今日错误数: $(grep -c "ERROR" logs/*.log)"
```

### 清理日志（谨慎！）

```bash
# 备份重要日志
cp -r logs/ logs_backup_$(date +%Y%m%d)/

# 清理旧备份
find logs/ -name "*.log.[3-9]" -delete

# 清空当前日志（会丢失数据！）
> logs/main.log
```

## 日志自动轮转

系统已配置自动轮转：
- 单文件最大：10MB
- 超过后自动重命名为 `.log.1`, `.log.2`, ...
- 保留最近5个备份
- **无需手动清理**

## 什么时候需要查看日志？

### ✅ 建议查看日志的情况

1. **API请求失败**
   - 用户上传文件失败
   - 分析结果异常
   - 导出文件错误

2. **性能问题**
   - 请求处理太慢
   - 系统响应延迟
   - 需要优化性能

3. **数据质量问题**
   - 分析结果不符合预期
   - 发现大量异常数据
   - 需要验证数据处理过程

4. **系统监控**
   - 定期健康检查
   - 统计使用情况
   - 发现潜在问题

### 🔍 日志中的关键信息

- `ERROR` - 必须处理的错误
- `WARNING` - 需要关注的警告
- `REQUEST_ERROR` - API请求失败
- `无效数据` - 数据质量问题
- `Duration: >3000ms` - 性能问题（>3秒）

## 更多帮助

- **详细指南**: [LOGGING_GUIDE.md](LOGGING_GUIDE.md)
- **更新日志**: [CHANGELOG_LOGGING.md](CHANGELOG_LOGGING.md)
- **完整总结**: [日志系统集成总结.md](日志系统集成总结.md)

## 常见问题

### Q: 日志文件在哪里？
A: `logs/` 目录，已自动创建

### Q: 如何找到特定请求的日志？
A: 使用请求ID：`grep "请求ID" logs/*.log`

### Q: 日志文件太大怎么办？
A: 会自动轮转，无需担心

### Q: 如何只看错误日志？
A: `grep "ERROR" logs/*.log`

### Q: 如何查看实时日志？
A: `tail -f logs/main.log`

---

**提示**: 日志系统已完全集成，无需任何配置即可使用！

**需要帮助？** 查看 [LOGGING_GUIDE.md](LOGGING_GUIDE.md) 获取详细说明

